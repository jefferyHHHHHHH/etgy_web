# 设计文档：UI 设计系统

## 上下文

### 背景

当前管理端采用 Vue 3 + TypeScript + Element Plus 技术栈，使用简单的顶部导航布局，存在视觉单一、组件复用率低、交互体验不足等问题。作为面向学院管理员和志愿者的专业管理平台，需要建立完整的设计系统。

### 约束

- 必须使用 Element Plus 作为基础 UI 框架
- 保持 TypeScript 严格模式
- 遵循 Vue 3 Composition API 规范
- 样式优先使用 scoped CSS，全局样式使用 CSS 变量
- 不引入新的第三方 UI 框架
- MVP 阶段，优先保证核心功能，次要功能可后续迭代

### 利益相关者

- **开发团队**：需要清晰的组件封装和使用文档
- **学院管理员**：需要专业、易用的管理界面
- **志愿者**：需要简单明了的内容创作和管理界面

## 目标 / 非目标

### 目标

1. 建立统一的设计系统，包含配色、字体、间距、圆角等规范
2. 实现经典的侧边栏 + 顶部栏布局，提升信息架构清晰度
3. 封装 5+ 通用组件，提升代码复用率 50% 以上
4. 增强交互体验（加载状态、操作反馈、快捷键）
5. 支持暗色模式和响应式布局
6. 关键页面（仪表盘、视频列表、审核工作台）体验显著提升

### 非目标

- 不重新设计所有页面的业务逻辑
- 不改变现有路由结构和权限体系
- 不引入复杂的动画库（使用 CSS 动画和 Vue 过渡）
- 不做国际化（本期不启用）
- 不做移动端原生适配（仅响应式 Web）

## 决策

### 决策 1：布局系统架构

**选择**：采用 `AppLayout` 根布局 + `PageContainer` 页面容器的两层架构

**理由**：

- `AppLayout` 负责全局布局（侧边栏、顶部栏、主内容区）
- `PageContainer` 负责页面级布局（标题、面包屑、操作区、内容区）
- 职责清晰，易于维护和扩展

**替代方案**：

- 方案 A：每个页面自己实现布局 → 维护成本高，不一致
- 方案 B：使用第三方布局组件（如 Vue Element Admin）→ 引入复杂依赖，定制性差

**实现**：

```
src/components/layout/
├── AppLayout.vue          # 根布局（侧边栏+顶部栏+主内容区）
├── Sidebar.vue            # 侧边栏
├── Topbar.vue             # 顶部栏
├── Breadcrumb.vue         # 面包屑
└── PageContainer.vue      # 页面容器
```

### 决策 2：设计系统实现方式

**选择**：使用 CSS 变量 + SCSS 变量的混合方案

**理由**：

- CSS 变量支持运行时主题切换（亮色/暗色模式）
- SCSS 变量适合编译时计算（如间距倍数）
- Element Plus 已支持 CSS 变量覆盖

**实现**：

```
src/styles/
├── variables.scss         # SCSS 变量（间距、字号等）
├── theme.css             # CSS 变量（颜色、阴影等）
├── mixins.scss           # SCSS mixins
└── global.scss           # 全局样式
```

**配色方案**（专业、正式风格）：

- **主色**：#1a56db（深蓝色，专业严肃）
- **成功色**：#16a34a（绿色）
- **警告色**：#ea580c（橙色）
- **危险色**：#dc2626（红色）
- **中性色**：灰度系列（#f9fafb, #f3f4f6, #e5e7eb, #d1d5db, #9ca3af, #6b7280, #4b5563, #374151, #1f2937, #111827）

### 决策 3：通用组件封装策略

**选择**：基于 Element Plus 组件封装业务组件，不从零开发

**理由**：

- Element Plus 已提供完善的基础组件
- 封装业务组件可以统一样式和交互
- 减少重复代码，提升维护效率

**组件清单**：
| 组件 | 用途 | 封装基础 |
|------|------|----------|
| PageContainer | 页面容器 | el-card |
| StatusTag | 状态标签 | el-tag |
| SearchForm | 搜索表单 | el-form |
| TableActions | 表格操作列 | el-button + v-permission |
| EmptyState | 空状态 | 自定义 + el-empty |
| LogoPlaceholder | Logo 占位 | 自定义 |

### 决策 4：图表可视化库选择

**选择**：ECharts（通过 vue-echarts）

**理由**：

- 功能强大，图表类型丰富
- 社区活跃，文档完善
- 支持响应式和主题定制
- Vue 生态成熟（vue-echarts）

**替代方案**：

- Chart.js：功能较弱，定制性差
- D3.js：学习曲线陡峭，开发成本高

**依赖**：

```json
{
  "echarts": "^5.4.3",
  "vue-echarts": "^6.6.1"
}
```

### 决策 5：虚拟滚动实现

**选择**：使用 `vue-virtual-scroller` 或自行封装轻量级虚拟滚动

**理由**：

- 视频列表、审核列表可能有大量数据
- 虚拟滚动可显著提升性能（仅渲染可见项）
- Element Plus 的 el-table 不原生支持虚拟滚动

**实现策略**：

1. 优先使用 el-table-v2（Element Plus 的虚拟化表格）
2. 如不满足需求，使用 `vue-virtual-scroller`
3. 最后考虑自行封装（基于 `IntersectionObserver`）

### 决策 6：快捷键系统

**选择**：自行封装 `useHotkeys` composable

**理由**：

- 需求简单（如 Ctrl+K 打开搜索，Esc 关闭弹窗）
- 避免引入重量级库（如 vue-hotkey）

**实现**：

```typescript
// src/composables/useHotkeys.ts
export function useHotkeys(
  keys: string,
  handler: (event: KeyboardEvent) => void,
  options?: { preventDefault?: boolean }
) {
  // 监听 keydown 事件
  // 支持组合键（如 Ctrl+K、Shift+Enter）
}
```

**支持的快捷键**：

- `Ctrl+K` / `Cmd+K`：打开全局搜索
- `Esc`：关闭弹窗/抽屉
- `Ctrl+S` / `Cmd+S`：保存表单（阻止浏览器默认行为）

### 决策 7：响应式布局断点

**选择**：采用移动优先（Mobile First）策略，使用标准断点

**断点定义**：

```scss
$breakpoints: (
  'xs': 0,
  // < 640px（手机）
  'sm': 640px,
  // 平板竖屏
  'md': 768px,
  // 平板横屏
  'lg': 1024px,
  // 笔记本
  'xl': 1280px,
  // 桌面
  '2xl': 1536px, // 大屏
);
```

**适配策略**：

- `< 768px`：隐藏侧边栏，改为抽屉式菜单
- `>= 768px`：显示侧边栏，支持折叠

## 风险 / 权衡

### 风险 1：大规模布局改造可能影响现有功能

**缓解措施**：

- 分阶段实施，每个阶段独立测试
- 保留现有路由和权限逻辑不变
- 使用 Git 特性分支，确保可回滚

### 风险 2：ECharts 包体积较大（~1MB）

**缓解措施**：

- 按需引入图表类型（仅引入需要的，如 Line、Bar、Pie）
- 使用 Vite 的代码分割（懒加载仪表盘页面）
- 预期首屏增加 < 200KB（Gzip 后）

### 风险 3：虚拟滚动可能与现有表格逻辑冲突

**缓解措施**：

- 优先在新页面或独立列表中使用
- 保留传统分页作为降级方案
- 充分测试排序、筛选、选中等功能

### 权衡：响应式 vs 原生移动端

**选择**：仅做响应式 Web，不做原生移动端适配

**理由**：

- MVP 阶段，用户主要在桌面端操作
- 响应式可覆盖平板和大屏手机
- 原生适配需要独立设计和开发，成本过高

## 迁移计划

### 步骤 1：建立设计系统基础（不影响现有功能）

- 创建样式系统目录和变量文件
- 编写布局组件（AppLayout、Sidebar、Topbar 等）
- 封装通用组件（PageContainer、StatusTag 等）
- **时间估计**：3-5 工作日

### 步骤 2：改造 App.vue 和登录页（首次可见变化）

- 替换 App.vue 为新布局
- 优化登录页样式和动画
- **测试重点**：路由跳转、权限校验、登录流程
- **时间估计**：2-3 工作日

### 步骤 3：改造核心页面

- 仪表盘（集成 ECharts）
- 视频列表（缩略图、批量操作）
- 审核工作台（左右分栏）
- **时间估计**：5-7 工作日

### 步骤 4：改造其余页面和高级功能

- 志愿者、学院、审计等页面
- 虚拟滚动、快捷键系统
- 响应式适配
- **时间估计**：3-5 工作日

### 回滚策略

- 使用特性分支开发，主分支保持稳定
- 每个阶段合并前需通过自测清单
- 如出现严重问题，可回滚到上一个稳定版本（通过 Git revert）

## 开放问题

1. **Logo 设计**：占位图使用什么？建议使用项目名称首字母或简单图形
2. **暗色模式触发方式**：用户手动切换 or 跟随系统？建议提供切换按钮（在顶部栏）
3. **侧边栏收起状态持久化**：是否需要记住用户偏好？建议存储到 localStorage
4. **图表主题**：是否需要与亮色/暗色模式联动？建议联动
5. **批量操作权限**：是否需要特殊权限控制？建议复用现有 RBAC 权限

## 验收标准

### 功能验收

- [ ] 侧边栏 + 顶部栏布局正常显示
- [ ] 侧边栏可折叠，状态持久化
- [ ] 面包屑导航正确显示当前路径
- [ ] 暗色模式切换正常，所有页面适配
- [ ] 5 个通用组件封装完成并正常使用
- [ ] 仪表盘图表正常渲染，支持响应式
- [ ] 视频列表支持缩略图预览和批量操作
- [ ] 审核工作台左右分栏布局正常
- [ ] 快捷键（Ctrl+K、Esc、Ctrl+S）正常工作
- [ ] 响应式布局在不同屏幕尺寸下正常

### 性能验收

- [ ] 首屏加载时间 < 2.5s（P95）
- [ ] 1000 条数据的列表渲染流畅（虚拟滚动）
- [ ] 暗色模式切换无闪烁
- [ ] 页面切换动画流畅（60fps）

### 代码质量验收

- [ ] 通过 ESLint 和 Stylelint 检查
- [ ] 组件有清晰的 Props 类型定义
- [ ] 关键组件有使用文档（JSDoc）
- [ ] 无控制台 error/warn
